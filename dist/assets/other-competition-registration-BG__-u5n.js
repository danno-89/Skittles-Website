import"./modulepreload-polyfill-B5Qt9EMX.js";import{i as F}from"./firebase.config-IpTQKhZm.js";import"./main-DLzLBIiP.js";import{initializeApp as O}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import{getFirestore as H,doc as q,getDoc as Q,setDoc as A,query as x,collection as L,where as E,getDocs as C,limit as M}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const $=O(F),I=H($),_=s=>{if(!s)return null;if(s.toDate)return s.toDate();if(s instanceof Date)return s;try{const e=new Date(s);return isNaN(e.getTime())?null:e}catch{return null}},k=async()=>{const s=document.getElementById("competition");s.innerHTML='<option value="" disabled selected>Loading competitions...</option>';try{const e=new Date,m=x(L(I,"events"),E("season","==","2025-26"),E("registrationClosed",">",e),E("registration","==",!0)),p=await C(m),r=[];p.forEach(a=>{const o=a.data();r.push({id:a.id,name:o.name})}),r.sort((a,o)=>a.name.localeCompare(o.name)),s.innerHTML='<option value="" disabled selected>Select a competition...</option>',r.forEach(a=>{const o=document.createElement("option");o.value=a.id,o.textContent=a.name,s.appendChild(o)})}catch(e){console.error("Error populating competitions:",e),s.innerHTML='<option value="" disabled selected>Failed to load competitions</option>'}},z=async s=>{const e=document.getElementById("competition-date-display"),m=document.getElementById("competition");if(!s){e.classList.add("hidden");return}let p=m.options[m.selectedIndex].text;try{const r=await C(x(L(I,"seasons"),E("status","==","current"),M(1)));if(r.empty){e.classList.add("hidden");return}const a=r.docs[0].data().name,o=await C(x(L(I,"events"),E("season","==",a),E("name","==",p),M(1)));if(o.empty)e.classList.add("hidden");else{const i=o.docs[0].data(),f=i.date?_(i.date):null;if(f){const h=f.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"});e.innerHTML=`Date: ${h} at 7:30pm`,e.classList.remove("hidden")}else e.classList.add("hidden")}}catch(r){console.error("Error fetching competition date:",r),e.classList.add("hidden")}},G=async s=>{const e=document.getElementById("player1-team"),m=document.getElementById("player2-team"),p=document.getElementById("competition"),r=p.options[p.selectedIndex],a=r?r.text.toLowerCase():"";e.innerHTML="",m.innerHTML="";const o=document.createElement("option");o.value="",o.textContent="Select a team...",o.disabled=!0,o.selected=!0,e.appendChild(o.cloneNode(!0)),m.appendChild(o.cloneNode(!0));const i=document.createElement("option");i.value="no-team",i.textContent="No Team",e.appendChild(i.cloneNode(!0)),m.appendChild(i.cloneNode(!0));try{const f=await C(L(I,"players_public")),h={};f.forEach(n=>{const t=n.data();t.teamId&&(h[t.teamId]||(h[t.teamId]={hasMale:!1,hasFemale:!1}),t.division==="Men's"&&(h[t.teamId].hasMale=!0),t.division==="Ladies'"&&(h[t.teamId].hasFemale=!0))});const y=x(L(I,"teams"),E("status","==","active"));(await C(y)).forEach(n=>{const t=n.id,c=n.data(),d=h[t]||{hasMale:!1,hasFemale:!1};let l=!1;if(a.includes("mixed")?l=d.hasMale&&d.hasFemale:a.includes("ladies")?l=d.hasFemale:a.includes("men's")?l=d.hasMale:l=!0,l){const v=document.createElement("option");v.value=c.name,v.textContent=c.name,e.appendChild(v.cloneNode(!0)),m.appendChild(v.cloneNode(!0))}}),e.value="",m.value=""}catch(f){console.error("Error updating available teams:",f)}},N=async(s,e,m,p=null,r=!0)=>{const a=document.getElementById(e);a.innerHTML="";const o=e.replace("-wrapper","");if(s==="no-team"||!s){const i=document.createElement("input");i.type="text",i.id=o,i.name=o,i.className="form-input",i.placeholder="Enter player name",r&&(i.required=!0),a.appendChild(i);return}try{const i=x(L(I,"teams"),E("name","==",s),M(1)),f=await C(i);if(f.empty)return;const h=f.docs[0].id,y=x(L(I,"players_public"),E("teamId","==",h)),u=await C(y),n=[];u.forEach(d=>{const l=d.data(),v=`${l.firstName} ${l.lastName}`,w={id:d.id,name:v};p?l.division===p&&n.push(w):n.push(w)}),n.sort((d,l)=>d.name.localeCompare(l.name));const t=document.createElement("select");t.id=o,t.name=o,t.className="form-select",r&&(t.required=!0);const c=document.createElement("option");c.value="",c.textContent="Select a player...",c.disabled=!0,c.selected=!0,t.appendChild(c),n.forEach(d=>{const l=document.createElement("option");l.value=d.id,l.textContent=d.name,t.appendChild(l)}),a.appendChild(t)}catch(i){console.error("Error creating player dropdown:",i)}};document.addEventListener("DOMContentLoaded",()=>{k();const s=document.getElementById("registration-form"),e=document.getElementById("competition"),m=document.getElementById("player1-label"),p=document.getElementById("player2-label"),r=document.getElementById("player1-team"),a=document.getElementById("player2-team"),o=document.getElementById("player2-label").nextElementSibling,i=document.getElementById("contact-info-section"),f=()=>{const y=e.value,u=e.options[e.selectedIndex],n=u?u.text.toLowerCase():"",t=n.includes("singles")||n.includes("individual");z(y),G(),N(null,"player1-name-wrapper",y,null,!0),N(null,"player2-name-wrapper",y,null,!t),t?(o.classList.add("hidden"),p.classList.add("hidden"),a.required=!1):(o.classList.remove("hidden"),p.classList.remove("hidden"),a.required=!0),n.includes("mixed")?(m.textContent="Male Player",p.textContent="Female Player"):(m.textContent="Player 1",p.textContent="Player 2")};e.addEventListener("change",f),r.addEventListener("change",()=>{const y=e.value,u=e.options[e.selectedIndex],n=u?u.text.toLowerCase():"";let t=null;n.includes("mixed")?t="Men's":n.includes("ladies")?t="Ladies'":n.includes("men's")&&(t="Men's"),N(r.value,"player1-name-wrapper",y,t,!0)}),a.addEventListener("change",()=>{const y=e.value,u=e.options[e.selectedIndex],n=u?u.text.toLowerCase():"",t=n.includes("singles")||n.includes("individual");let c=null;n.includes("mixed")||n.includes("ladies")?c="Ladies'":n.includes("men's")&&(c="Men's"),N(a.value,"player2-name-wrapper",y,c,!t)});const h=()=>{r.value==="no-team"&&a.value==="no-team"?i.classList.remove("hidden"):i.classList.add("hidden")};r.addEventListener("change",h),a.addEventListener("change",h),s&&s.addEventListener("submit",async y=>{y.preventDefault();const u=e.value,n=e.options[e.selectedIndex],t=n?n.text.toLowerCase():"",c=t.includes("singles")||t.includes("individual"),d=r.value,l=a.value,v=document.getElementById("contact-number").value;let w,B,b,T;if(d==="no-team")w=document.getElementById("player1-name").value,B=null;else{const g=document.getElementById("player1-name");B=g.value,w=g.options[g.selectedIndex].text}if(!c)if(l==="no-team")b=document.getElementById("player2-name").value,T=null;else{const g=document.getElementById("player2-name");T=g.value,b=g.options[g.selectedIndex].text}if(!w||!b&&!c||!d||!l&&!c){alert("All player and team fields are required.");return}if(d==="no-team"&&(l==="no-team"||c)&&!v){alert("A contact number is required as neither player is registered to a team.");return}const D={player1Name:w,player1Team:d==="no-team"?"":d,player1PublicId:B,timestamp:new Date};c||(D.player2Name=b,D.player2Team=l==="no-team"?"":l,D.player2PublicId=T),v&&(D.contactNumber=v);try{const g=q(I,"competition-registrations",u),S=await Q(g),P=S.exists()?S.data().entries:[];await A(g,{entries:[...P,D]}),alert("Registration successful!"),window.location.href=`other_competitions.html?tab=${u}`}catch(g){console.error("Error adding document: ",g),alert("There was an error with your registration. Please try again.")}}),f()});
