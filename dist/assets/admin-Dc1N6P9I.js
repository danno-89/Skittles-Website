import"./modulepreload-polyfill-B5Qt9EMX.js";import{e as T,c as b,b as f,q,w as A,h as X,u as C,d as S,g as P,T as j,m as ye,n as fe,p as ge,r as we}from"./firebase.config-IpTQKhZm.js";/* empty css             */import{a as Ie}from"./main-CA5my9sR.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";let M=[],J=new Map,$=new Map;async function ie(){try{const t=q(b(f,"match_results"),A("status","==","completed"),X("scheduledDate","desc"));M=(await T(t)).docs.map(n=>({id:n.id,...n.data()}))}catch(t){console.error("Error fetching completed fixtures:",t)}}async function Se(){try{(await T(b(f,"players_public"))).forEach(e=>J.set(e.id,{id:e.id,...e.data()}))}catch(t){console.error("Error fetching players:",t)}}async function ve(){try{(await T(b(f,"teams"))).forEach(e=>$.set(e.id,e.data().name))}catch(t){console.error("Error fetching teams:",t)}}function le(){const t=document.getElementById("edit-date-select");if(!t)return;t.innerHTML='<option value="">Select a date</option>',[...new Set(M.map(n=>n.scheduledDate.toDate().toISOString().split("T")[0]))].forEach(n=>{const r=document.createElement("option");r.value=n,r.textContent=new Date(n).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short"}),t.appendChild(r)})}function Ee(){const t=document.getElementById("edit-date-select"),e=document.getElementById("edit-match-select"),n=document.getElementById("edit-results-form-container");t&&(t.addEventListener("change",()=>{e.innerHTML='<option value="">Select a match</option>',e.disabled=!0,n.style.display="none",M.filter(a=>a.scheduledDate.toDate().toISOString().split("T")[0]===t.value).forEach(a=>{const c=$.get(a.homeTeamId),i=$.get(a.awayTeamId),o=a.scheduledDate.toDate().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),s=document.createElement("option");s.value=a.id,s.textContent=`${c} vs ${i} (${o})`,e.appendChild(s)}),e.disabled=!1}),e.addEventListener("change",async()=>{n.style.display="none";const r=e.value,a=M.find(c=>c.id===r);if(a){document.getElementById("edit-home-team-name-header").textContent=$.get(a.homeTeamId),document.getElementById("edit-away-team-name-header").textContent=$.get(a.awayTeamId),document.getElementById("edit-home-bowled-first").value=a.homeTeamId,document.getElementById("edit-away-bowled-first").value=a.awayTeamId,a.bowledFirst===a.homeTeamId?document.getElementById("edit-home-bowled-first").checked=!0:document.getElementById("edit-away-bowled-first").checked=!0;const c=document.getElementById("edit-home-team-scorecard"),i=document.getElementById("edit-away-team-scorecard");await te(a.homeTeamId,c,J,a.homeScores),await te(a.awayTeamId,i,J,a.awayScores),z(c,document.getElementById("edit-home-team-total-display")),z(i,document.getElementById("edit-away-team-total-display")),n.style.display="block"}}),document.getElementById("submit-edited-results-btn").addEventListener("click",async()=>{var u;const r=e.value,a=M.find(p=>p.id===r),c=p=>Array.from(document.querySelectorAll(`#${p} tbody tr`)).map(d=>({playerId:d.querySelector(".player-select").value,hands:Array.from(d.querySelectorAll(".hand-score")).map(I=>parseInt(I.value)||0),score:parseInt(d.querySelector(".total-score-col").textContent)})).filter(d=>d.playerId&&d.hands.length===5),i=c("edit-home-team-scorecard"),o=c("edit-away-team-scorecard"),s=(u=document.querySelector('input[name="edit-bowled-first"]:checked'))==null?void 0:u.value,m=[];if(i.length<6&&m.push("Home team has incomplete scores."),o.length<6&&m.push("Away team has incomplete scores."),s||m.push("Please select which team bowled first."),m.length>0){alert(`Please correct the following issues:

- `+m.join(`
- `));return}const l={homeScore:parseInt(document.getElementById("edit-home-team-total-display").textContent),awayScore:parseInt(document.getElementById("edit-away-team-total-display").textContent),homeScores:i,awayScores:o,bowledFirst:s,status:"completed"};try{await be(a),await C(S(f,"match_results",r),l),await Te(a,l),alert("Results updated and league table adjusted successfully!"),await ie(),le(),e.innerHTML='<option value="">Select a match</option>',e.disabled=!0,n.style.display="none"}catch(p){console.error("Error submitting edited results:",p),alert("An error occurred while submitting the edited results.")}}))}async function te(t,e,n,r){if(!e)return;const a=Array.from(n.values()).filter(o=>o.teamId===t);e.innerHTML=`
        <thead>
            <tr>
                <th class="player-name-col">Player</th>
                <th>H1</th><th>H2</th><th>H3</th><th>H4</th><th>H5</th>
                <th class="total-score-col">Total</th>
            </tr>
        </thead>
        <tbody>
            ${r.map(o=>`
                <tr>
                    <td class="player-name-col">
                        <select class="player-select">
                            <option value="">Select player</option>
                            <option value="sixthPlayer">6th Player</option>
                            ${a.map(s=>`<option value="${s.id}">${s.firstName} ${s.lastName}</option>`).join("")}
                        </select>
                    </td>
                    ${o.hands.map(s=>`<td class="hand-score-col"><input type="number" class="hand-score" min="0" max="27" value="${s}"></td>`).join("")}
                    <td class="total-score-col">${o.score}</td>
                </tr>
            `).join("")}
        </tbody>`;const c=e.querySelectorAll(".player-select");r.forEach((o,s)=>{c[s]&&(c[s].value=o.playerId)});const i=()=>{const o=Array.from(c).map(s=>s.value).filter(s=>s&&s!=="sixthPlayer");c.forEach(s=>{const m=s.value;Array.from(s.options).forEach(l=>{l.value&&l.value!=="sixthPlayer"&&l.value!==m&&(o.includes(l.value)?l.style.display="none":l.style.display="block")})})};c.forEach(o=>{o.addEventListener("change",()=>{z(e,e.id.includes("home")?document.getElementById("edit-home-team-total-display"):document.getElementById("edit-away-team-total-display")),i()})}),i(),e.addEventListener("input",o=>{if(o.target.classList.contains("hand-score")){const s=o.target.closest("tr");if(s){const m=Array.from(s.querySelectorAll(".hand-score")).map(u=>parseInt(u.value)||0);s.querySelector(".total-score-col").textContent=m.reduce((u,p)=>u+p,0);const l=e.id.includes("home")?document.getElementById("edit-home-team-total-display"):document.getElementById("edit-away-team-total-display");l&&z(e,l)}}})}function z(t,e){if(!t||!e)return;const n=Array.from(t.querySelectorAll("tbody .total-score-col")).map(r=>parseInt(r.textContent)||0);e.textContent=n.reduce((r,a)=>r+a,0)}async function be(t){var h;const{homeTeamId:e,awayTeamId:n,division:r,season:a,homeScore:c,awayScore:i}=t;let o,s;c>i?(o={result:"won",points:2},s={result:"lost",points:0}):i>c?(o={result:"lost",points:0},s={result:"won",points:2}):(o={result:"drawn",points:1},s={result:"drawn",points:1});const m=S(f,"league_tables",a),l=await P(m);if(!l.exists()){console.error(`League table for season ${a} not found.`);return}const p=((h=l.data()[r])==null?void 0:h.standings)||[],d=(g,v,x,B)=>{const E=p.findIndex(y=>y.teamId===g);if(E!==-1){const y=p[E];y.played-=1,y.won-=v.result==="won"?1:0,y.lost-=v.result==="lost"?1:0,y.drawn-=v.result==="drawn"?1:0,y.points-=v.points,y.pinsFor-=x,y.pinsAgainst-=B,p[E]=y}};d(e,o,c,i),d(n,s,i,c);const I={[`${r}.standings`]:p};await C(m,I)}async function Te(t,e){const{homeTeamId:n,awayTeamId:r,division:a,season:c}=t,{homeScore:i,awayScore:o}=e;let s,m;i>o?(s={result:"won",points:2},m={result:"lost",points:0}):o>i?(s={result:"lost",points:0},m={result:"won",points:2}):(s={result:"drawn",points:1},m={result:"drawn",points:1});const l=S(f,"league_tables",c),u=await P(l);if(!u.exists()){console.error(`League table for season ${c} not found.`);return}const p=u.data();p[a]||(p[a]={leagueName:a.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),standings:[]});const d=p[a].standings||[],I=(g,v,x,B)=>{let E=d.findIndex(_=>_.teamId===g);E===-1&&(d.push({teamId:g,teamName:$.get(g)}),E=d.length-1);const y=d[E];y.played=(y.played??0)+1,y.won=(y.won??0)+(v.result==="won"?1:0),y.lost=(y.lost??0)+(v.result==="lost"?1:0),y.drawn=(y.drawn??0)+(v.result==="drawn"?1:0),y.points=(y.points??0)+v.points,y.pinsFor=(y.pinsFor??0)+x,y.pinsAgainst=(y.pinsAgainst??0)+B,(!y.max_score||x>y.max_score)&&(y.max_score=x),d[E]=y};I(n,s,i,o),I(r,m,o,i);const h={[`${a}.standings`]:d};await C(l,h)}async function xe(){await ve(),await Se(),await ie(),le(),Ee()}let V=[],K;const w={postponedSelect:null,dateInput:null,timeInput:null,rescheduleBtn:null,feedbackDiv:null};async function Be(){const t=q(b(f,"match_results"),A("status","==","postponed"));V=(await T(t)).docs.map(n=>({id:n.id,...n.data()})),V.sort((n,r)=>n.scheduledDate.toMillis()-r.scheduledDate.toMillis())}function De(){w.postponedSelect.innerHTML='<option value="">1. Select Fixture to Move</option>',V.forEach(t=>{const e=K.get(t.homeTeamId)||"Unknown",n=K.get(t.awayTeamId)||"Unknown",r=t.scheduledDate.toDate().toLocaleDateString("en-GB"),a=document.createElement("option");a.value=t.id,a.textContent=`${r} - ${e} vs ${n}`,w.postponedSelect.appendChild(a)})}function N(){w.rescheduleBtn.disabled=!(w.postponedSelect.value&&w.dateInput.value&&w.timeInput.value)}async function Le(){const t=w.postponedSelect.value,e=w.dateInput.value,n=w.timeInput.value;if(!t||!e||!n){R("Please select a fixture and enter a new date and time.","error");return}const[r,a,c]=e.split("-").map(Number),[i,o]=n.split(":").map(Number),s=new Date(r,a-1,c,i,o);if(confirm("Are you sure you want to reschedule this fixture to the new date and time?")){w.rescheduleBtn.disabled=!0,R("Rescheduling fixture...","info");try{const l=S(f,"match_results",t);await C(l,{scheduledDate:j.fromDate(s),status:"rescheduled"}),R("Fixture rescheduled successfully!","success"),await de()}catch(l){console.error("Error updating fixture:",l),R(`An error occurred: ${l.message}`,"error")}finally{N()}}}function R(t,e){w.feedbackDiv.textContent=t,w.feedbackDiv.className=`feedback-message ${e}`,w.feedbackDiv.style.display="block"}async function de(){await Be(),De(),w.dateInput.value="",w.timeInput.value="",N()}function Ce(t){if(K=t,w.postponedSelect=document.getElementById("postponed-fixture-select"),w.dateInput=document.getElementById("new-date-input"),w.timeInput=document.getElementById("new-time-input"),w.rescheduleBtn=document.getElementById("reschedule-submit-btn"),w.feedbackDiv=document.getElementById("reschedule-feedback"),!w.postponedSelect||!w.dateInput||!w.timeInput||!w.rescheduleBtn){console.error("Reschedule fixture tab elements not found!");return}w.postponedSelect.addEventListener("change",N),w.dateInput.addEventListener("change",N),w.timeInput.addEventListener("change",N),w.rescheduleBtn.addEventListener("click",Le),de()}async function $e(){const t=document.getElementById("news-form"),e=document.getElementById("news-list"),n=document.getElementById("news-id");async function r(){if(!e)return;e.innerHTML="<h3>Existing News</h3>";const a=q(b(f,"news"),X("timestamp","desc"));(await T(a)).forEach(i=>{const o=i.data(),s=document.createElement("div");s.classList.add("news-item"),s.innerHTML=`
                <h3>${o.title}</h3>
                <p>${o.content}</p>
                <div class="news-item-actions">
                    <button class="btn btn-secondary edit-news-btn" data-id="${i.id}">Edit</button>
                    <button class="btn btn-danger delete-news-btn" data-id="${i.id}">Delete</button>
                </div>
            `,e.appendChild(s)})}t.addEventListener("submit",async a=>{a.preventDefault();const c=document.getElementById("news-title").value,i=document.getElementById("news-content").value,o=n.value;o?await C(S(f,"news",o),{title:c,content:i}):await ye(b(f,"news"),{title:c,content:i,timestamp:ge()}),t.reset(),n.value="",r()}),e.addEventListener("click",async a=>{if(a.target.classList.contains("edit-news-btn")){const c=a.target.dataset.id,i=S(f,"news",c),s=(await getDoc(i)).data();document.getElementById("news-title").value=s.title,document.getElementById("news-content").value=s.content,n.value=c}if(a.target.classList.contains("delete-news-btn")){const c=a.target.dataset.id;confirm("Are you sure you want to delete this news item?")&&(await fe(S(f,"news",c)),r())}}),r()}let k=new Map,U=[],ne=!1;async function Ae(){if(ne)return;const t=document.getElementById("correction-season-select"),e=document.getElementById("correction-division-select"),n=document.getElementById("generate-table-btn"),r=document.getElementById("correction-container"),a=document.getElementById("current-table"),c=document.getElementById("corrected-table"),i=document.getElementById("confirm-update-btn");!t||!e||!n||(await Pe(),await Fe(t,e),t.addEventListener("change",()=>ue(t.value,e)),n.addEventListener("click",()=>Me(t.value,e.value,r,a,c,i)),i.addEventListener("click",()=>qe(t.value,e.value)),ne=!0)}async function Pe(){(await T(b(f,"teams"))).forEach(e=>k.set(e.id,e.data().name))}async function Fe(t,e){const n=await T(b(f,"league_tables")),r=[...new Set(n.docs.map(a=>a.id))].sort((a,c)=>c.localeCompare(a));t.innerHTML='<option value="">Select a Season</option>',r.forEach(a=>{const c=document.createElement("option");c.value=a,c.textContent=a.replace("-"," - "),t.appendChild(c)}),r.length>0&&(t.value=r[0],await ue(r[0],e))}async function ue(t,e){if(e.innerHTML='<option value="">Select a Division</option>',!t)return;const n=S(f,"league_tables",t),r=await P(n);if(r.exists()){const a=r.data();Object.keys(a).filter(i=>i!=="season").map(i=>({id:i,name:a[i].leagueName||i})).sort((i,o)=>i.name.localeCompare(o.name)).forEach(i=>{const o=document.createElement("option");o.value=i.id,o.textContent=i.name,e.appendChild(o)})}else console.error(`League document for season ${t} not found.`)}async function Me(t,e,n,r,a,c){if(!t||!e){alert("Please select a season and division.");return}n.style.display="block",c.style.display="none";const i=await Ne(t,e);oe(i,r);const o=await ke(t,e);U=He(o,i),oe(U,a,"Corrected",i);const s=(u,p)=>(u.id||u.teamId).localeCompare(p.id||p.teamId),m=JSON.stringify(i.map(u=>({...u,teamName:void 0})).sort(s)),l=JSON.stringify(U.map(u=>({...u,teamName:void 0})).sort(s));m!==l&&(c.style.display="block")}async function Ne(t,e){const n=S(f,"league_tables",t),r=await P(n);if(r.exists()){const a=r.data();if(a[e]&&a[e].standings)return a[e].standings.map(c=>({...c,id:c.teamId,teamName:k.get(c.teamId)||"Unknown"}))}return[]}async function ke(t,e){const n=q(b(f,"match_results"),A("season","==",t),A("division","==",e),A("status","==","completed"));return(await T(n)).docs.map(a=>a.data())}function He(t,e){const n=new Map;return e.forEach(r=>{const a=r.id||r.teamId;n.set(a,{id:a,played:0,won:0,drawn:0,lost:0,points:0,pinsFor:0,pinsAgainst:0})}),t.forEach(r=>{const{homeTeamId:a,awayTeamId:c,homeScore:i,awayScore:o}=r,s=n.get(a),m=n.get(c);if(!s||!m)return;let l=0,u=0,p="lost",d="lost";i>o?(l=2,p="won"):o>i?(u=2,d="won"):(l=1,u=1,p="drawn",d="drawn"),ae(s,p,l,i,o),ae(m,d,u,o,i)}),Array.from(n.values())}function ae(t,e,n,r,a){t.played++,e==="won"&&t.won++,e==="drawn"&&t.drawn++,e==="lost"&&t.lost++,t.points+=n,t.pinsFor+=r,t.pinsAgainst+=a}function oe(t,e,n,r=null){const a=document.createElement("table");a.className="league-standings-table",a.innerHTML="<thead><tr><th>Team</th><th>Pld</th><th>W</th><th>D</th><th>L</th><th>Pts</th><th>PF</th><th>PA</th></tr></thead><tbody></tbody>";const c=a.querySelector("tbody");[...t].sort((o,s)=>s.points-o.points||s.pinsFor-s.pinsAgainst-(o.pinsFor-o.pinsAgainst)||(k.get(o.id)||"").localeCompare(k.get(s.id)||"")).forEach(o=>{const s=document.createElement("tr"),m=k.get(o.id)||"Unknown";if(s.innerHTML=`
            <td>${m}</td>
            <td>${o.played}</td>
            <td>${o.won}</td>
            <td>${o.drawn}</td>
            <td>${o.lost}</td>
            <td>${o.points}</td>
            <td>${o.pinsFor}</td>
            <td>${o.pinsAgainst}</td>
        `,r){const l=r.find(u=>u.id===o.id);if(l){const u=(p,d,I)=>{d>I?p.classList.add("highlight-increase"):d<I&&p.classList.add("highlight-decrease")};u(s.cells[1],o.played,l.played),u(s.cells[2],o.won,l.won),u(s.cells[3],o.drawn,l.drawn),u(s.cells[4],o.lost,l.lost),u(s.cells[5],o.points,l.points),u(s.cells[6],o.pinsFor,l.pinsFor),u(s.cells[7],o.pinsAgainst,l.pinsAgainst)}}c.appendChild(s)}),e.innerHTML="",e.appendChild(a)}async function qe(t,e){const n=S(f,"league_tables",t);try{const r=U.map(c=>{const{teamName:i,...o}=c;return{...o,teamId:c.id}}),a={};a[`${e}.standings`]=r,await C(n,a),alert("League table updated successfully!"),document.getElementById("correction-container").style.display="none"}catch(r){console.error("Error updating league table:",r),alert("An error occurred while updating the league table.")}}const D=new Map;let L=[],O=new Map,H={};document.addEventListener("DOMContentLoaded",()=>{Ie.then(({user:t,publicData:e})=>{const n=document.getElementById("tab-content-container");if(!n){console.error("Admin page content container not found.");return}t&&(e!=null&&e.committee)?_e():n.innerHTML="<p>You do not have the necessary permissions to view this page.</p>"})});async function _e(){try{await Re(),await Z(),await Oe(),je(),Ge(),ze(),xe(),Ce(D),$e(),Ae()}catch(t){console.error("An error occurred during admin page initialisation:",t);const e=document.getElementById("tab-content-container");e&&(e.innerHTML="<p>A critical error occurred while loading the admin page. Please try again later.</p>")}}async function Re(){(await T(b(f,"teams"))).forEach(e=>D.set(e.id,e.data().name))}async function Z(){const t=q(b(f,"match_results"),A("status","in",["scheduled","rescheduled"]),X("scheduledDate"));L=(await T(t)).docs.map(n=>({id:n.id,...n.data()}))}async function Oe(){(await T(b(f,"players_public"))).forEach(n=>O.set(n.id,{id:n.id,public:n.data()})),(await T(b(f,"players_private"))).forEach(n=>{O.has(n.id)?O.get(n.id).private=n.data():O.set(n.id,{id:n.id,private:n.data()})})}async function Ue(t){try{const e=S(f,"ssc_cup",t),n=await P(e);n.exists()?H=n.data().teamAverages||{}:(console.warn(`No ssc_cup data found for season: ${t}`),H={})}catch(e){console.error("Error fetching team averages:",e),H={}}}async function Y(t,e){const n=document.getElementById(e);if(n){if(!t){n.textContent="";return}try{const r=S(f,"competitions",t),a=await P(r);a.exists()?n.textContent=a.data().name:n.textContent="Competition details not found."}catch(r){console.error("Error fetching competition name:",r),n.textContent="Error loading competition name."}}}function je(){const t=document.getElementById("admin-tabs-container"),e=document.getElementById("tab-content-container");if(!t||!e){console.error("Tab containers not found. Tab functionality will be disabled.");return}const n=t.querySelectorAll(".tab-link"),r=e.querySelectorAll(".tab-pane");n.forEach(a=>{a.addEventListener("click",()=>{const c=a.dataset.tab;n.forEach(i=>i.classList.remove("active")),a.classList.add("active"),r.forEach(i=>{i.classList.toggle("active",i.id===`${c}-content`)})})})}function ze(){const t=document.getElementById("postpone-fixture-form");if(!t)return;const e=document.getElementById("fixture-to-postpone-select"),n=document.getElementById("postponing-team-select"),r=document.getElementById("postponement-date-input"),a=document.getElementById("postpone-fixture-status");!e||!n||!r||!a||(e.addEventListener("change",()=>{n.innerHTML='<option value="">Which team postponed?</option>',n.disabled=!0;const c=L.find(i=>i.id===e.value);if(c){const i=D.get(c.homeTeamId)||"Unknown",o=D.get(c.awayTeamId)||"Unknown";n.innerHTML+=`<option value="${c.homeTeamId}">${i}</option>`,n.innerHTML+=`<option value="${c.awayTeamId}">${o}</option>`,n.disabled=!1}}),t.addEventListener("submit",async c=>{c.preventDefault();const{value:i}=e,{value:o}=n,{value:s}=r;if(!i||!o||!s){a.textContent="Please fill out all fields.",a.className="status-error";return}try{await C(S(f,"match_results",i),{status:"postponed",postponedBy:o,postponedDate:j.fromDate(new Date(s))}),a.textContent="Fixture successfully postponed!",a.className="status-success",t.reset(),n.disabled=!0,await Z(),se()}catch(m){console.error("Error postponing fixture:",m),a.textContent="An error occurred. Please try again.",a.className="status-error"}}),se())}function se(){const t=document.getElementById("fixture-to-postpone-select");t&&(t.innerHTML='<option value="">Select a fixture to postpone</option>',L.forEach(e=>{const n=D.get(e.homeTeamId)||"Unknown",r=D.get(e.awayTeamId)||"Unknown",a=e.scheduledDate.toDate().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),c=document.createElement("option");c.value=e.id,c.textContent=`${a} - ${n} vs ${r}`,t.appendChild(c)}))}function Ge(){const t=document.getElementById("date-select"),e=document.getElementById("match-select"),n=document.getElementById("results-form-container"),r=document.getElementById("submit-results-btn");if(!t||!e||!n||!r){console.error("One or more elements for results input are missing.");return}let a=new Map;const c=async()=>{(await T(b(f,"players_public"))).forEach(s=>{const m=s.data();a.set(s.id,{id:s.id,name:`${m.firstName} ${m.lastName}`,teamId:m.teamId})})},i=()=>{t.innerHTML='<option value="">Select a date</option>';const o=[...new Set(L.map(s=>s.scheduledDate.toDate().toISOString().split("T")[0]))];o.sort((s,m)=>new Date(s)-new Date(m)),o.forEach(s=>{const m=document.createElement("option");m.value=s,m.textContent=new Date(s).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short"}),t.appendChild(m)})};t.addEventListener("change",()=>{e.innerHTML='<option value="">Select a match</option>',n.style.display="none",Y(null,"competition-name");const o=L.filter(s=>s.scheduledDate.toDate().toISOString().split("T")[0]===t.value);o.forEach(s=>{const m=D.get(s.homeTeamId),l=D.get(s.awayTeamId),u=s.scheduledDate.toDate().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),p=document.createElement("option");p.value=s.id,p.textContent=`${m} vs ${l} (${u})`,e.appendChild(p)}),e.disabled=!o.length}),e.addEventListener("change",async()=>{n.style.display="none";const o=L.find(s=>s.id===e.value);o?(await Y(o.division,"competition-name"),o.division==="ssc-cup"&&await Ue(o.season),document.getElementById("home-team-name-header").textContent=D.get(o.homeTeamId),document.getElementById("away-team-name-header").textContent=D.get(o.awayTeamId),document.getElementById("home-bowled-first").value=o.homeTeamId,document.getElementById("away-bowled-first").value=o.awayTeamId,re("home",o,a),re("away",o,a),n.style.display="block"):Y(null,"competition-name")}),r.addEventListener("click",async()=>{var I;const o=e.value,s=h=>Array.from(document.querySelectorAll(`#${h} tbody tr`)).map(g=>{if(g.id.endsWith("-handicap-row"))return null;const v=g.querySelector(".player-select").value,x=Array.from(g.querySelectorAll(".hand-score")).map(E=>parseInt(E.value)||0),B=x.reduce((E,y)=>E+y,0);return{playerId:v,hands:x,score:B}}).filter(g=>g&&g.playerId&&g.hands.length===5),m=s("home-team-scorecard"),l=s("away-team-scorecard"),u=(I=document.querySelector('input[name="bowled-first"]:checked'))==null?void 0:I.value,p=[];if(m.length<6&&p.push("Home team has incomplete scores."),l.length<6&&p.push("Away team has incomplete scores."),u||p.push("Please select which team bowled first."),p.length>0){alert(`Please correct the following issues:

- `+p.join(`
- `));return}const d={homeScore:parseInt(document.getElementById("home-team-total-display").textContent),awayScore:parseInt(document.getElementById("away-team-total-display").textContent),homeScores:m,awayScores:l,bowledFirst:u,status:"completed"};try{const h=L.find(g=>g.id===o);await we(f,async g=>{let v,x,B,E;["premier-division","first-division"].includes(h.division)?(v=S(f,"league_tables",`${h.season}_${h.division}`),x=await g.get(v)):h.division==="ssc-cup"&&(B=S(f,"ssc_cup",h.season),E=await g.get(B));const y=S(f,"match_results",o),_=new Set([...m.map(F=>F.playerId),...l.map(F=>F.playerId)]);_.delete("sixthPlayer");const ee=h.scheduledDate.toDate(),me=j.fromDate(ee),G=new Date(ee);G.setFullYear(G.getFullYear()+1);const pe=j.fromDate(G);let Q,W;v&&x.exists()&&(Q=Qe(h,d,x.data())),B&&E.exists()&&(W=We(h,d,E.data())),g.update(y,d),Q&&g.update(v,{teams:Q}),W&&g.update(B,W);for(const F of _){const he=S(f,"players_public",F);g.update(he,{recentFixture:me,registerExpiry:pe})}}),alert("Results submitted successfully!"),await Z(),i(),n.style.display="none"}catch(h){console.error("Error submitting results:",h),alert("An error occurred while submitting results.")}}),(async()=>(await c(),i()))()}function re(t,e,n){const r=document.getElementById(`${t}-team-scorecard`),a=e[`${t}TeamId`],c=Array.from(n.values()).filter(l=>l.teamId===a),i=l=>{const u=Array.from(r.querySelectorAll(".player-select")).map(d=>d.value),p=l.value;l.innerHTML='<option value="">Select player</option><option value="sixthPlayer">6th Player</option>',c.forEach(d=>{if(!u.includes(d.id)||d.id===p){const I=document.createElement("option");I.value=d.id,I.textContent=d.name,l.appendChild(I)}}),l.value=p};let o="",s=0;if(e.division==="ssc-cup"){const l=H[e.homeTeamId]||0,u=H[e.awayTeamId]||0,p=Math.round(Math.abs(l-u)*.95);(t==="home"&&l<u||t==="away"&&u<l)&&(s=p),s>0&&(o=`
                <tr id="${t}-handicap-row">
                    <td class="player-name-col"><strong>Handicap</strong></td>
                    <td colspan="5"></td>
                    <td class.total-score-col">${s}</td>
                </tr>
            `)}r.innerHTML=`
        <thead>
            <tr>
                <th class="player-name-col">Player</th>
                <th>H1</th><th>H2</th><th>H3</th><th>H4</th><th>H5</th>
                <th class="total-score-col">Total</th>
            </tr>
        </thead>
        <tbody>
            ${Array(6).fill().map(()=>`
                <tr>
                    <td class="player-name-col"><select class="form-select player-select"></select></td>
                    ${Array(5).fill().map(()=>'<td class="hand-score-col"><input type="number" class="hand-score" min="0" max="27"></td>').join("")}
                    <td class="total-score-col">0</td>
                </tr>
            `).join("")}
            ${o}
        </tbody>`;const m=r.querySelectorAll(".player-select");m.forEach(i),r.addEventListener("change",l=>{l.target.classList.contains("player-select")&&m.forEach(u=>{u!==l.target&&i(u)})}),r.addEventListener("input",l=>{if(l.target.classList.contains("hand-score")){const u=l.target.closest("tr"),p=Array.from(u.querySelectorAll(".hand-score")).map(d=>parseInt(d.value)||0);u.querySelector(".total-score-col").textContent=p.reduce((d,I)=>d+I,0),ce(r,s)}}),ce(r,s)}function ce(t,e=0){const r=Array.from(t.querySelectorAll('tbody tr:not([id*="-handicap-row"]) .total-score-col')).map(c=>parseInt(c.textContent)||0).reduce((c,i)=>c+i,0)+e,a=t.id.includes("home")?document.getElementById("home-team-total-display"):document.getElementById("away-team-total-display");a.textContent=r}function Qe(t,e,n){const{homeTeamId:r,awayTeamId:a}=t,{homeScore:c,awayScore:i,bowledFirst:o}=e,s=n.teams.find(d=>d.teamId===r),m=n.teams.find(d=>d.teamId===a);let l=0,u=0;c>i?l=2:i>c?u=2:(l=1,u=1),o===r&&c<i?l++:o===a&&i<c&&u++;const p=(d,I,h,g)=>{d.played=(d.played||0)+1,d.won=(d.won||0)+(I>=2?1:0),d.drawn=(d.drawn||0)+(I===1?1:0),d.lost=(d.lost||0)+(I<1?1:0),d.points=(d.points||0)+I,d.pinsFor=(d.pinsFor||0)+h,d.pinsAgainst=(d.pinsAgainst||0)+g};return s&&p(s,l,c,i),m&&p(m,u,i,c),n.teams}function We(t,e,n){const{homeTeamId:r,awayTeamId:a,round:c}=t,{homeScore:i,awayScore:o}=e,s=c.replace("Group Stage - ","Group_"),m=n[s],l=m.standings.find(h=>h.teamName===r),u=m.standings.find(h=>h.teamName===a);let p=0,d=0;i>o?p=2:o>i?d=2:(p=1,d=1);const I=(h,g)=>{h.played=(h.played||0)+1,h.won=(h.won||0)+(g===2?1:0),h.drawn=(h.drawn||0)+(g===1?1:0),h.lost=(h.lost||0)+(g===0?1:0),h.points=(h.points||0)+g};return l&&I(l,p),u&&I(u,d),n[s]=m,n}
