import"../modulepreload-polyfill-B5Qt9EMX.js";import{d as D,b as $,x as k,u as S}from"../firebase.config-IpTQKhZm.js";/* empty css                    */const M=document.querySelector(".game-wrapper");let b=null,E=null,l=null,h={home:[],away:[]},s=[],y=0,u="",f="home",w=0,g=0,T=!1;document.addEventListener("DOMContentLoaded",()=>{if(b=new URLSearchParams(window.location.search).get("gameId"),!b){document.body.innerHTML="<h1>Error: No game ID provided.</h1>";return}E=D($,"scoreboard",b),k(E,a=>{if(!a.exists()){document.body.innerHTML=`<h1>Error: Game with ID ${b} not found.</h1>`;return}l=a.data(),y=l.currentTurnIndex||0,T||P(),T&&H()})});function P(){T||(T=!0,M.style.display="flex",document.addEventListener("keydown",q),H())}function H(){if(G(),U(),y<s.length){const{team:a,playerIndex:e,handIndex:n}=s[y];f=a,w=e,g=n}A(),j()}function G(){const a=l.bowlingTeam;if(!a)return;const e=a==="home"?"away":"home";h.home=Object.keys(l.homeTeam.players).sort((t,o)=>parseInt(t.replace("player",""))-parseInt(o.replace("player",""))),h.away=Object.keys(l.awayTeam.players).sort((t,o)=>parseInt(t.replace("player",""))-parseInt(o.replace("player","")));const n=h.home.length;s=[],[{team:a,handIndex:0},{team:e,handIndex:0},{team:e,handIndex:1},{team:a,handIndex:1},{team:a,handIndex:2},{team:e,handIndex:2},{team:e,handIndex:3},{team:a,handIndex:3},{team:a,handIndex:4},{team:e,handIndex:4}].forEach(t=>{for(let o=0;o<n;o++)s.push({team:t.team,playerIndex:o,handIndex:t.handIndex})})}function q(a){const e=a.key;if((!isNaN(e)||e==="Enter"||e==="Return"||e==="Backspace"||e.startsWith("Arrow"))&&a.preventDefault(),!isNaN(e))u.length<2&&(u+=e,v());else if(e==="Enter"||e==="Return"){if(u!==""){const n=parseInt(u,10);u="",W(n).then(O)}}else e==="Backspace"?(u=u.slice(0,-1),v()):e.startsWith("Arrow")&&(u="",R(e),A())}function R(a){let e=s.findIndex(t=>t.team===f&&t.playerIndex===w&&t.handIndex===g);e===-1&&(e=y);let n;if(a==="ArrowUp")n=(e-1+s.length)%s.length;else if(a==="ArrowDown")n=(e+1)%s.length;else if(a==="ArrowLeft")n=(e-1+s.length)%s.length;else if(a==="ArrowRight")n=(e+1)%s.length;else return;const r=s[n];f=r.team,w=r.playerIndex,g=r.handIndex}async function W(a){const e=f==="home"?"homeTeam":"awayTeam",n=h[f][w],t=[...l[e].players[n].hands];t[g]=a;const o=t.reduce((i,c)=>i+(c||0),0);await S(E,{[`${e}.players.${n}.hands`]:t,[`${e}.players.${n}.totalScore`]:o})}async function O(){const a=s.findIndex(n=>n.team===f&&n.playerIndex===w&&n.handIndex===g),e=(a===-1?y:a)+1;if(e>=s.length){console.log("Game Over!"),document.removeEventListener("keydown",q),await S(E,{gameStatus:"finished"});return}await S(E,{currentTurnIndex:e})}function U(){document.getElementById("home-team-header").textContent=l.homeTeam.name,document.getElementById("away-team-header").textContent=l.awayTeam.name;const a=document.getElementById("scoreboard-grid");a.innerHTML="";const e=document.createElement("div");e.className="team-column";const n=document.createElement("div");n.className="team-column";let r=0;const t=[0,0,0,0,0];h.home.forEach((c,p)=>{const m=l.homeTeam.players[c];e.appendChild(N(m,"home",p)),r+=m.totalScore||0,m.hands.forEach((I,x)=>t[x]+=I||0)});let o=0;const i=[0,0,0,0,0];h.away.forEach((c,p)=>{const m=l.awayTeam.players[c];n.appendChild(N(m,"away",p)),o+=m.totalScore||0,m.hands.forEach((I,x)=>i[x]+=I||0)}),e.appendChild(L(t)),n.appendChild(L(i)),a.append(e,n),document.getElementById("home-total-score").textContent=r,document.getElementById("away-total-score").textContent=o,document.getElementById("scoreboard-footer").textContent=`Match Total: ${r+o}`}function j(){var m,I,x,B;if(!T||!s.length||y>=s.length){document.getElementById("home-sub-score-wrapper").style.display="none",document.getElementById("away-sub-score-wrapper").style.display="none";return}const{team:a,playerIndex:e,handIndex:n}=s[y],r=s.find(d=>d.handIndex===n).team;let t=0,o=0;for(let d=0;d<n;d++)h.home.forEach(C=>t+=l.homeTeam.players[C].hands[d]||0),h.away.forEach(C=>o+=l.awayTeam.players[C].hands[d]||0);if(a===r)for(let d=0;d<e;d++)t+=((m=l.homeTeam.players[h.home[d]])==null?void 0:m.hands[n])||0,o+=((I=l.awayTeam.players[h.away[d]])==null?void 0:I.hands[n])||0;else{for(let d=0;d<h.home.length;d++)t+=((x=l.homeTeam.players[h.home[d]])==null?void 0:x.hands[n])||0;for(let d=0;d<e;d++)o+=((B=l.awayTeam.players[h.away[d]])==null?void 0:B.hands[n])||0}const i=document.getElementById("home-sub-score-wrapper"),c=document.getElementById("away-sub-score-wrapper");(a==="home"?"away":"home")==="home"?(document.getElementById("home-sub-score").textContent=t,i.style.display="block",c.style.display="none"):(document.getElementById("away-sub-score").textContent=o,c.style.display="block",i.style.display="none"),e===0&&a===r&&(i.style.display="none",c.style.display="none")}function A(){if(!T)return;document.querySelectorAll(".bowling-now, .current-hand").forEach(e=>e.classList.remove("bowling-now","current-hand"));const a=document.querySelector(`.player-card[data-team="${f}"][data-player-index="${w}"]`);if(a){a.classList.add("bowling-now");const e=a.querySelector(`.hand-score[data-hand-index="${g}"]`);e&&(e.classList.add("current-hand"),v())}}function v(){const a=document.querySelector(".current-hand");if(a)if(u!=="")a.textContent=u;else{const e=a.closest(".player-card").dataset.team,n=parseInt(a.closest(".player-card").dataset.playerIndex,10),r=parseInt(a.dataset.handIndex,10),t=h[e][n],o=l[e==="home"?"homeTeam":"awayTeam"].players[t].hands[r];a.textContent=o??"-"}}function N(a,e,n){const r=document.createElement("div");r.className="player-card",r.dataset.team=e,r.dataset.playerIndex=n;const t=document.createElement("span");t.className="player-name",t.textContent=a.name;const o=document.createElement("div");o.className="hands-container";for(let c=0;c<5;c++){const p=document.createElement("div");p.className="hand-score",p.dataset.handIndex=c;const m=a.hands[c];p.textContent=m??"-",o.appendChild(p)}const i=document.createElement("span");return i.className="player-total-score",i.textContent=a.totalScore||0,r.append(t,o,i),r}function L(a){const e=document.createElement("div");e.className="player-card totals-row";const n=document.createElement("div");return n.className="hands-container",a.forEach(r=>{const t=document.createElement("div");t.className="total-hand-score",t.textContent=r>0?r:"-",n.appendChild(t)}),e.innerHTML='<span class="player-name"></span>',e.appendChild(n),e.innerHTML+='<span class="player-total-score"></span>',e}
