import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as T,d as C,b as v,q as M,c as F,w as N,j as A,e as q}from"./firebase.config-IpTQKhZm.js";/* empty css             */import"./main-CA5my9sR.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";let P=null,d=null,g="",f="";const j=()=>new URLSearchParams(window.location.search).get("matchId"),U=()=>new URLSearchParams(window.location.search).get("from"),x=async e=>{if(!e)return"Team N/A";try{const t=await T(C(v,"teams",e));return t.exists()?t.data().name:"Unknown Team"}catch(t){return console.error("Error fetching team name:",t),"Team Fetch Error"}},R=async e=>{if(!e)return"Competition N/A";try{const t=await T(C(v,"competitions",e));return t.exists()?t.data().name:"Unknown Competition"}catch(t){return console.error("Error fetching competition name:",t),"Competition Fetch Error"}},W=async e=>{const t=new Map,a=[...new Set(e.filter(r=>r&&r!=="sixthPlayer"))];if(a.length===0)return t;const l=[];for(let r=0;r<a.length;r+=10)l.push(a.slice(r,r+10));try{await Promise.all(l.map(async r=>{const n=M(F(v,"players_public"),N(A(),"in",r));(await q(n)).forEach(s=>{const m=s.data(),c=`${m.firstName||""} ${m.lastName||""}`.trim();t.set(s.id,c||"Unknown Player")})}))}catch(r){console.error("Error fetching player names in batch:",r)}return t},E=(e,t)=>{if(!Array.isArray(e)||e.length===0)return null;const a={teamScore:0,bestHand:0,spares:0,nines:0,eights:0,sevens:0,pinsFromSpares:0,noSpareScore:0,bestPlayer:{name:"N/A",score:0}};let l=-1,r=0;return e.forEach(n=>{const i=n.score||0;a.teamScore+=i,i>l&&(l=i,a.bestPlayer={name:n.playerId==="sixthPlayer"?"6th Player":t.get(n.playerId)||"Unknown Player",score:i}),n.hands.forEach(s=>{s>a.bestHand&&(a.bestHand=s),s>=10&&(a.spares++,r+=s),s===9&&a.nines++,s===8&&a.eights++,s===7&&a.sevens++})}),a.pinsFromSpares=r-a.spares*9,a.noSpareScore=a.teamScore-a.pinsFromSpares,a},I=(e,t,a)=>{if(!Array.isArray(e)||e.length===0||!e[0].hands)return'<div class="player-scores-table-container"><p>Score data is not available.</p></div>';const l=e[0].hands.map((c,h)=>`<th>${h+1}</th>`).join(""),r=e.map(c=>{const h=c.playerId==="sixthPlayer"?"6th Player":a.get(c.playerId)||"Unknown Player",p=c.hands.map(u=>`<td><span class="${u>=10?"highlight-score":""}">${u}</span></td>`).join("");return`<tr><td>${h}</td>${p}<td class="total-score">${c.score}</td></tr>`}).join(""),n=e[0].hands.length,i=Array(n).fill(0);let s=0;e.forEach(c=>{c.hands.forEach((h,p)=>{i[p]+=h}),s+=c.score});const m=i.map(c=>`<td>${c}</td>`).join("");return`
        <div class="player-scores-table-container">
            <h3>${t} Scores</h3>
            <table class="player-scores-table">
                <thead>
                    <tr>
                        <th>Player</th>
                        ${l}
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    ${r}
                </tbody>
                <tfoot>
                    <tr class="team-totals">
                        <td>Team Hand Totals</td>
                        ${m}
                        <td class="total-score">${s}</td>
                    </tr>
                </tfoot>
            </table>
        </div>`},V=(e,t,a,l)=>{if(!e||!t)return"<p>Statistics cannot be generated as score data is incomplete.</p>";const r='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="currentColor" class="winner-icon"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.27 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z"></path></svg>',i=[{label:"Team Score",home:e.teamScore,away:t.teamScore},{label:"Pins from Spares",home:e.pinsFromSpares,away:t.pinsFromSpares},{label:"No Spare Score",home:e.noSpareScore,away:t.noSpareScore},{label:"Best Hand",home:e.bestHand,away:t.bestHand},{label:"Spares (10+)",home:e.spares,away:t.spares},{label:"9s",home:e.nines,away:t.nines},{label:"8s",home:e.eights,away:t.eights},{label:"7s",home:e.sevens,away:t.sevens},{label:"Best Player",home:`${e.bestPlayer.name} (${e.bestPlayer.score})`,away:`${t.bestPlayer.name} (${t.bestPlayer.score})`}].map(s=>{const m=s.label==="Best Player"?e.bestPlayer.score:s.home,c=s.label==="Best Player"?t.bestPlayer.score:s.away,h=m>c,p=c>m,u=m===c&&m>0;return`<tr>
            <td class="stat-value home-value ${h?"winner":""} ${u?"tie":""}">${s.home} ${h?r:""}</td>
            <td class="stat-label">${s.label}</td>
            <td class="stat-value away-value ${p?"winner":""} ${u?"tie":""}">${s.away} ${p?r:""}</td>
        </tr>`}).join("");return`<div class="statistics-container"><table class="statistics-table"><colgroup><col><col><col></colgroup><thead><tr>
            <th class="home-header">${a}</th><th>Metric</th><th class="away-header">${l}</th>
            </tr></thead><tbody>${i}</tbody></table></div>`},k=e=>{var u,w;const t=document.getElementById("score-progression-chart").getContext("2d");if(!t)return;P&&P.destroy();const{homeScores:a,awayScores:l,bowledFirst:r}=d;let n=0,i=0;const s=[0],m=[0],c=[0];let h=["Start"];if(e==="simultaneous"||e==="battle")for(let o=0;o<5;o++)for(let y=0;y<6;y++)n+=((u=a[y])==null?void 0:u.hands[o])||0,i+=((w=l[y])==null?void 0:w.hands[o])||0,s.push(n),m.push(i),c.push(n-i),h.push("");else{const o=r==="home"?a:l,y=r==="home"?l:a,b=(B,H,D)=>{var L;for(let $=0;$<6;$++){const S=((L=B[$])==null?void 0:L.hands[H])||0;D?r==="home"?n+=S:i+=S:r==="home"?i+=S:n+=S,s.push(n),m.push(i),h.push("")}};b(o,0,!0),b(y,0,!1),b(y,1,!1),b(o,1,!0),b(o,2,!0),b(y,2,!1),b(y,3,!1),b(o,3,!0),b(o,4,!0),b(y,4,!1)}const p=e==="battle"?[{label:"Lead",data:c,segment:{borderColor:o=>o.p1.raw>=0?"#006400":"#FFC107",backgroundColor:o=>o.p1.raw>=0?"rgba(0, 100, 0, 0.1)":"rgba(255, 193, 7, 0.1)"},fill:"origin"}]:[{label:g,data:s,borderColor:"#006400",backgroundColor:"rgba(0, 100, 0, 0.1)",fill:!0},{label:f,data:m,borderColor:"#FFC107",backgroundColor:"rgba(255, 193, 7, 0.1)",fill:!0}];P=new Chart(t,{type:"line",data:{labels:h,datasets:p},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{generateLabels:function(o){return e==="battle"?[{text:`${g} Lead`,fillStyle:"rgba(0, 100, 0, 0.1)",strokeStyle:"#006400",lineWidth:1,hidden:!1,index:0},{text:`${f} Lead`,fillStyle:"rgba(255, 193, 7, 0.1)",strokeStyle:"#FFC107",lineWidth:1,hidden:!1,index:1}]:Chart.defaults.plugins.legend.labels.generateLabels(o)}}}},scales:{x:{title:{display:!0,text:"Player Turn"},grid:{color:o=>o.index>0&&o.index%6===0?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.1)"},ticks:{display:!1}},y:{title:{display:!0,text:e==="battle"?"Point Difference":"Cumulative Score"},beginAtZero:e!=="battle"}}}})},_=()=>{const e=document.querySelectorAll(".tab-link"),t=document.querySelectorAll(".tab-pane"),a=document.querySelector(".graph-controls-container");e.forEach(l=>{l.addEventListener("click",()=>{const r=l.dataset.tab;e.forEach(n=>n.classList.remove("active")),l.classList.add("active"),t.forEach(n=>n.id===`${r}-content`?n.classList.add("active"):n.classList.remove("active")),r==="graph"?a.style.display="block":a.style.display="none"})})},G=()=>{const e=document.getElementById("back-btn");if(!e)return;const t=U();e.href=t==="team-management"?"team-management.html":"fixtures-results.html",e.textContent=t==="team-management"?"← Back to Team":"← Back to Fixtures"};async function z(){const e=j(),t=document.getElementById("match-details-container"),a=document.getElementById("scoreboard-content"),l=document.getElementById("statistics-content"),r=document.getElementById("graph-view-select");if(!(!e||!t||!a||!l)){a.innerHTML="<p>Loading scoreboard...</p>",l.innerHTML="<p>Loading statistics...</p>";try{const n=await T(C(v,"match_results",e));if(!n.exists()){t.innerHTML="<p>Match not found.</p>";return}d=n.data(),[g,f]=await Promise.all([x(d.homeTeamId),x(d.awayTeamId)]);const i=await R(d.division),s=d.scheduledDate.toDate(),m=s.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),c=s.toLocaleTimeString("en-GB",{hour:"numeric",minute:"2-digit",hour12:!0});if(t.innerHTML=`
            <div class="match-header-card">
                <div class="result-display">
                    <span class="team-name home-team">${g}</span>
                    <span class="score">${d.homeScore} - ${d.awayScore}</span>
                    <span class="team-name away-team">${f}</span>
                </div>
                <div class="match-meta-container">
                    <div class="match-date-info"><strong>Date:</strong><span>${m} at ${c}</span></div>
                    <div class="match-competition-info"><strong>Competition:</strong><span>${i}</span></div>
                </div>
            </div>`,d.homeScores&&d.awayScores){const h=[...d.homeScores,...d.awayScores].map(o=>o.playerId),p=await W(h);a.innerHTML=`
                <div class="player-scores-grid">
                    ${I(d.homeScores,g,p)}
                    ${I(d.awayScores,f,p)}
                </div>`;const u=E(d.homeScores,p),w=E(d.awayScores,p);l.innerHTML=V(u,w,g,f),k(r.value),r.addEventListener("change",o=>{k(o.target.value)})}else a.innerHTML="<p>Scoreboard data is not available for this match.</p>",l.innerHTML="<p>Statistics are not available for this match.</p>";_()}catch(n){console.error("A critical error occurred:",n),t.innerHTML="<p>An error occurred while loading match details.</p>"}}}document.addEventListener("htmlIncludesLoaded",()=>{z(),G()});
