import"./modulepreload-polyfill-B5Qt9EMX.js";import{e as g,c as w,b as u,q as T,w as f,l as D,h as N,d as E,g as H}from"./firebase.config-IpTQKhZm.js";/* empty css             */import"./main-DLzLBIiP.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const L=document.getElementById("competition-tabs-container"),v=document.getElementById("overview-content"),m=document.getElementById("competition-content-container"),d=document.getElementById("competition-dates-container"),M=e=>{if(!e)return null;if(e.toDate)return e.toDate();if(e instanceof Date)return e;try{const n=new Date(e);return isNaN(n.getTime())?null:n}catch{return null}},S=async()=>{const e=document.createElement("div");e.className="tabs-main";const n=document.createElement("button");n.className="tab-link active",n.textContent="Overview",n.dataset.competitionId="overview",n.onclick=a=>{a.preventDefault(),h("overview","Overview")},e.appendChild(n);try{(await g(w(u,"competitions"))).docs.forEach(s=>{const i=s.data(),p=i.type||i.Type||null,r=s.id;let c=i.competitionName||i.name||null;if(c==="Open Pair's"&&(c="Open Pairs"),c&&typeof p=="string"&&(p.includes("Individual")||p.includes("Pairs"))){const l=document.createElement("button");l.className="tab-link",l.textContent=c,l.dataset.competitionId=r,l.onclick=y=>{y.preventDefault(),h(r,c)},e.appendChild(l)}})}catch(a){console.error("Error fetching competitions for tabs:",a)}L.innerHTML="",L.appendChild(e);const t=new URLSearchParams(window.location.search).get("tab");if(t){const a=e.querySelector(`[data-competition-id='${t}']`);if(a){const s=a.textContent;h(t,s)}else h("overview","Overview")}else h("overview","Overview")},B=async()=>{if(d){d.innerHTML="<h2>Competition Dates</h2>";try{const e=await g(T(w(u,"seasons"),f("status","==","current"),D(1)));if(e.empty){d.innerHTML+="<p>Current season not set.</p>";return}const o=e.docs[0].data().name;if(!o){d.innerHTML+="<p>Season data is incomplete.</p>";return}d.innerHTML+=`<h3>${o}</h3>`;const t=await g(T(w(u,"events"),f("season","==",o),f("registration","==",!0),N("date")));k(t.docs)}catch(e){console.error("Error fetching competition dates:",e),d.innerHTML+="<p>Error loading dates.</p>"}}},k=e=>{if(e.length===0){d.innerHTML+="<p>No competitions are currently open for registration.</p>";return}const n=document.createElement("ul");n.className="competition-dates-list",e.forEach(o=>{const t=o.data(),a=document.createElement("li"),s=M(t.date),i=s?s.toLocaleDateString("en-GB",{day:"numeric",month:"short"}):"Date TBC";a.innerHTML=`<strong>${t.name}</strong><span>${i}</span>`,n.appendChild(a)}),d.appendChild(n)},I=async(e,n)=>{if(d){d.innerHTML="<h2>Past Winners</h2>";try{const o=await H(E(u,"winners",e));if(o.exists()){const t=o.data().history||[];b(t,n)}else b([],n)}catch(o){console.error(`Error fetching winners for ${n}:`,o),d.innerHTML+="<p>Could not load winners.</p>"}}},b=(e,n)=>{if(e.length===0){d.innerHTML+=`<p>No past winners found for ${n}.</p>`;return}const o=document.createElement("ul");o.className="winners-list",e.sort((t,a)=>(a.season||"").localeCompare(t.season||"")),e.forEach(t=>{if(t.season&&t.winner){const a=document.createElement("li");let s;typeof t.winner=="object"&&t.winner.player1&&t.winner.player2?s=`${t.winner.player1} & ${t.winner.player2}`:typeof t.winner=="object"&&t.winner.male&&t.winner.female?s=`${t.winner.female} & ${t.winner.male}`:s=t.winner,a.innerHTML=`<span class="season">${t.season}</span><span class="winner">${s}</span>`,o.appendChild(a)}}),d.appendChild(o)},P=async(e,n)=>{if(m){m.innerHTML=`<h2>${e}</h2><p>Loading details...</p>`;try{const o=await g(T(w(u,"seasons"),f("status","==","current"),D(1)));if(o.empty){m.innerHTML=`<h2>${e}</h2><p>Current season not configured.</p>`;return}const t=o.docs[0].data().name,a=await g(T(w(u,"events"),f("season","==",t),f("name","==",e),D(1)));let s=null,i=[];if(!a.empty){const p=a.docs[0];s=p.data();const r=p.id,c=E(u,"competition-registrations",r),l=await H(c);l.exists()&&l.data().entries&&(i=l.data().entries)}R(s,e,i,n)}catch(o){console.error(`Error fetching details for ${e}:`,o),m.innerHTML=`<h2>${e}</h2><p>Could not load competition details.</p>`}}},R=(e,n,o,t)=>{let a=`<h2>${n}</h2>`;if(e){const i=e.date?M(e.date):null;let p=null;i&&(p=new Date(i),p.setDate(p.getDate()-7));const r=i?i.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"To be confirmed",c=p?p.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"To be confirmed";a+=`
            <div class="competition-details">
                <p><strong>Competition Date:</strong> ${r}</p>
                <p><strong>Registration Closes:</strong> ${c}</p>
                <p><strong>Tournament Draw:</strong> Not yet available</p>
            </div>
        `}else a+="<p>Details for this competition have not been scheduled for the current season yet.</p>";m.innerHTML=a;const s=document.createElement("div");if(s.className="registrations-section",s.innerHTML="<h3>Current Entrants</h3>",o&&o.length>0){const i=document.createElement("ul");i.className="registration-list",[...o].sort((r,c)=>r.timestamp.seconds-c.timestamp.seconds).forEach(r=>{const c=document.createElement("li");let l;const y=r.player1Team?` (${r.player1Team})`:"";if(r.player1PublicId?l=`<span class="player-name">${r.player1Name}</span>${y}`:l=`${r.player1Name}${y}`,r.player2Name){let C;const $=r.player2Team?` (${r.player2Team})`:"";r.player2PublicId?C=`<span class="player-name">${r.player2Name}</span>${$}`:C=`${r.player2Name}${$}`,c.innerHTML=`<span>${l} & ${C}</span>`}else c.innerHTML=`<span>${l}</span>`;i.appendChild(c)}),s.appendChild(i)}else{const i=document.createElement("p");i.textContent="No-one has registered for this competition yet.",s.appendChild(i)}m.appendChild(s)},h=(e,n)=>{L.querySelectorAll(".tab-link").forEach(t=>{t.classList.toggle("active",t.dataset.competitionId===e)}),e==="overview"?(v&&(v.style.display="block"),m&&(m.style.display="none"),B()):(v&&(v.style.display="none"),m&&(m.style.display="block"),P(n,e),I(e,n))};S();
