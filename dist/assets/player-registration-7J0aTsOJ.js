import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as l,b as u,q as g,w as p,e as f,a as y,f as h}from"./firebase.config-IpTQKhZm.js";import"./main-CA5my9sR.js";import{httpsCallable as v}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import{createUserWithEmailAndPassword as E}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";let i={};async function I(){const e=document.getElementById("team");if(e)try{const n=l(u,"teams"),t=g(n,p("status","==","active")),o=await f(t);e.innerHTML='<option value="">Please select a team</option>',o.forEach(s=>{const r=s.data(),a=document.createElement("option");a.value=s.id,a.textContent=r.name,e.appendChild(a)})}catch(n){console.error("Error fetching teams: ",n),e.innerHTML='<option value="">Could not load teams</option>'}}function b(){const e=document.getElementById("dob");e&&(e.addEventListener("input",n=>{let t=n.target.value.replace(/\D/g,"");t.length>2&&(t=`${t.substring(0,2)}/${t.substring(2)}`),t.length>5&&(t=`${t.substring(0,5)}/${t.substring(5,9)}`),n.target.value=t}),e.addEventListener("blur",n=>{const t=n.target.value.split("/");if(t.length===3){const o=parseInt(t[0],10),s=parseInt(t[1],10),r=parseInt(t[2],10),a=new Date(r,s-1,o),c=a.getFullYear()===r&&a.getMonth()+1===s&&a.getDate()===o;n.target.setCustomValidity(c?"":"Please enter a valid date.")}else n.target.value?n.target.setCustomValidity("Please use dd/mm/yyyy format."):n.target.setCustomValidity("")}))}function d(e){const n=document.getElementById(e);n&&n.addEventListener("input",t=>{let o=t.target.value.replace(/\D/g,"");o.length>5&&(o=`${o.substring(0,5)} ${o.substring(5,11)}`),t.target.value=o})}function L(){const e=document.getElementById("postcode");e&&e.addEventListener("input",n=>{let t=n.target.value.toUpperCase().replace(/\s/g,"");t.length>3&&(t=`${t.substring(0,3)} ${t.substring(3,6)}`),n.target.value=t.trim()})}function B(){const e=document.getElementById("registration-form");e&&e.addEventListener("submit",n=>{n.preventDefault();const t=document.getElementById("mobile-number"),o=document.getElementById("home-work-number");if(t.setCustomValidity(""),!t.value.trim()&&!o.value.trim()){t.setCustomValidity("Please provide at least one contact number."),e.reportValidity();return}if(!e.checkValidity()){e.reportValidity();return}const s=new FormData(e);i={firstName:s.get("first-name"),lastName:s.get("last-name"),dob:s.get("dob"),email:s.get("email"),teamId:s.get("team"),division:s.get("division"),mobileNo:s.get("mobile-number"),homeNo:s.get("home-work-number"),address:{line1:s.get("address-line-1"),line2:s.get("address-line-2"),line3:s.get("address-line-3"),parish:s.get("parish"),postCode:s.get("postcode")}},$(i)})}function $(e){const n=document.getElementById("confirmation-section"),t=document.getElementById("confirmation-content");if(!n||!t)return;const o=document.getElementById("team").options[document.getElementById("team").selectedIndex].text,r=[e.address.line1,e.address.line2,e.address.line3,e.address.parish,e.address.postCode].filter(a=>a).join(", ");t.innerHTML=`
        <div class="summary-grid">
            <strong>First Name:</strong> <span>${e.firstName}</span>
            <strong>Last Name:</strong> <span>${e.lastName}</span>
            <strong>Date of Birth:</strong> <span>${e.dob}</span>
            <strong>Email:</strong> <span>${e.email}</span>
            <strong>Team:</strong> <span>${o}</span>
            <strong>Division:</strong> <span>${e.division||"N/A"}</span>
            <strong>Mobile Number:</strong> <span>${e.mobileNo||"N/A"}</span>
            <strong>Home/Work Number:</strong> <span>${e.homeNo||"N/A"}</span>
            <strong>Address:</strong> <span>${r}</span>
        </div>
    `,document.getElementById("registration-container").classList.add("hidden"),n.classList.remove("hidden")}function N(){const e=document.getElementById("account-creation-form");e&&e.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("password").value,o=document.getElementById("confirm-password").value,s=document.getElementById("password-error");if(t!==o){s.classList.remove("hidden");return}s.classList.add("hidden");try{const a=(await E(y,i.email,t)).user;i.authId=a.uid,m()}catch(r){alert(`Account creation failed: ${r.message}`),console.error("Account creation error:",r)}})}async function m(){const e=v(h,"registerPlayer");try{const n=await e(i);n.data.success?w(i):(alert(`Registration failed: ${n.data.error}`),console.error("Error:",n.data.error))}catch(n){alert("There was an error connecting to the server. Please try again."),console.error("Error:",n)}}function w(e){const n=document.getElementById("summary-section"),t=document.getElementById("summary-content");if(!n||!t)return;const o=document.getElementById("team").options[document.getElementById("team").selectedIndex].text,r=[e.address.line1,e.address.line2,e.address.line3,e.address.parish,e.address.postCode].filter(a=>a).join(", ");t.innerHTML=`
        <p>Thank you for registering! Your registration for <strong>${o}</strong> has been submitted.</p>
        <hr>
        <div class="summary-grid">
            <strong>First Name:</strong> <span>${e.firstName}</span>
            <strong>Last Name:</strong> <span>${e.lastName}</span>
            <strong>Date of Birth:</strong> <span>${e.dob}</span>
            <strong>Email:</strong> <span>${e.email}</span>
            <strong>Team:</strong> <span>${o}</span>
            <strong>Division:</strong> <span>${e.division||"N/A"}</span>
            <strong>Mobile Number:</strong> <span>${e.mobileNo}</span>
            <strong>Home/Work Number:</strong> <span>${e.homeNo||"N/A"}</span>
            <strong>Address:</strong> <span>${r}</span>
        </div>
    `,document.getElementById("confirmation-section").classList.add("hidden"),document.getElementById("account-creation-section").classList.add("hidden"),n.classList.remove("hidden")}function C(){const e=document.getElementById("cancel-submission"),n=document.getElementById("proceed-to-account"),t=document.getElementById("back-to-details"),o=document.getElementById("close-summary"),s=document.getElementById("register-no-account");e==null||e.addEventListener("click",()=>{document.getElementById("confirmation-section").classList.add("hidden"),document.getElementById("registration-container").classList.remove("hidden")}),s==null||s.addEventListener("click",()=>{delete i.authId,m()}),n==null||n.addEventListener("click",()=>{document.getElementById("confirmation-section").classList.add("hidden"),document.getElementById("account-creation-section").classList.remove("hidden")}),t==null||t.addEventListener("click",r=>{r.preventDefault(),document.getElementById("account-creation-section").classList.add("hidden"),document.getElementById("confirmation-section").classList.remove("hidden")}),o==null||o.addEventListener("click",()=>{window.location.href="/index.html"})}document.addEventListener("DOMContentLoaded",()=>{I(),b(),d("mobile-number"),d("home-work-number"),L(),B(),N(),C()});
