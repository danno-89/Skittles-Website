import"./modulepreload-polyfill-B5Qt9EMX.js";import{q as D,c as y,b as S,h as L,e as E,w as T}from"./firebase.config-IpTQKhZm.js";import"./main-CA5my9sR.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";document.addEventListener("DOMContentLoaded",()=>{const h=document.getElementById("calendar-container"),g=document.getElementById("season-filter");if(!h||!g){console.error("Required calendar elements not found.");return}const p=e=>{if(!e)return null;if(typeof e.toDate=="function")return e.toDate();const s=new Date(e);return s instanceof Date&&!isNaN(s.getTime())?s:null},C=async(e,s,n)=>{const t=[],o=new Date(s.getTime()-s.getTimezoneOffset()*6e4),d=new Date(n.getTime()-n.getTimezoneOffset()*6e4),l=async r=>{try{const a=D(y(S,r),T("season","==",e));(await E(a)).forEach(i=>{const c=i.data();if(Array.isArray(c.date)&&c.date.length===2){const m=p(c.date[0]),f=p(c.date[1]);m&&f&&t.push({date:m,endDate:f,isRange:!0,time:"All Day",type:"event-general",description:c.name})}else{const m=p(c.date);if(!m)return;let f="All Day";(m.getUTCHours()!==0||m.getUTCMinutes()!==0)&&(f=m.toLocaleTimeString("en-GB",{hour:"numeric",minute:"2-digit",hour12:!0,timeZone:"Europe/London"})),t.push({date:m,time:f,type:"event-general",description:c.name})}})}catch(a){console.error(`Error fetching ${r}:`,a)}};await l("events"),await l("competitions");try{const r=D(y(S,"match_results"),T("scheduledDate",">=",o.toISOString()),T("scheduledDate","<=",d.toISOString()));(await E(r)).forEach(u=>{const i=u.data(),c=p(i.scheduledDate);if(!c)return;const m=c.toLocaleTimeString("en-GB",{hour:"numeric",minute:"2-digit",hour12:!0,timeZone:"Europe/London"});i.status==="scheduled"?t.push({date:c,time:m,type:"fixture-occupied",description:`${i.homeTeamName||"TBC"} vs ${i.awayTeamName||"TBC"}`}):i.status==="spare"&&t.push({date:c,time:m,type:"fixture-spare",description:"Spare Slot for Postponed Fixtures"})})}catch(r){console.error("Error fetching match_results:",r)}return t.sort((r,a)=>r.date-a.date),t},w=e=>{if(h.innerHTML="",e.length===0){h.innerHTML="<p>No events found for this season.</p>";return}let s=0;for(;s<e.length;){const n=e[s],t=document.createElement("div");t.className="schedule-day";const o=document.createElement("div");o.className="schedule-date-header";const d=document.createElement("ul");if(d.className="schedule-item-list",n.isRange){const l=n.date.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"}),r=n.endDate.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"});o.textContent=`${l} - ${r}`;const a=document.createElement("li");a.className=`schedule-item ${n.type}`,a.innerHTML=`<div class="schedule-item-time">${n.time}</div><div class="schedule-item-description">${n.description}</div>`,d.appendChild(a),s++}else{const l=n.date.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"});o.textContent=l;const r=[];let a=s;for(;a<e.length&&e[a].date.toDateString()===n.date.toDateString();)r.push(e[a]),a++;r.sort((u,i)=>u.time==="All Day"?-1:i.time==="All Day"?1:u.time.localeCompare(i.time)),r.forEach(u=>{const i=document.createElement("li");i.className=`schedule-item ${u.type}`,i.innerHTML=`<div class="schedule-item-time">${u.time}</div><div class="schedule-item-description">${u.description}</div>`,d.appendChild(i)}),s=a}t.appendChild(o),t.appendChild(d),h.appendChild(t)}},v=async()=>{h.innerHTML="Loading...";const e=g.options[g.selectedIndex];if(!e)return;const s=e.value,n=e.dataset.startDate,t=e.dataset.endDate;if(!n||!t){h.innerHTML="<p>This season has no defined start and end date.</p>";return}const o=new Date(n),d=new Date(t),l=await C(s,o,d);w(l)};(async()=>{try{const e=D(y(S,"seasons"),L("name","desc"));(await E(e)).forEach(n=>{var d,l;const t=n.data(),o=document.createElement("option");o.value=t.name,o.textContent=t.name,t.start&&t.end&&(o.dataset.startDate=(d=p(t.start))==null?void 0:d.toISOString(),o.dataset.endDate=(l=p(t.end))==null?void 0:l.toISOString()),t.status==="current"&&(o.selected=!0),g.appendChild(o)})}catch(e){console.error("Error fetching seasons:",e)}g.addEventListener("change",v),v()})()});
