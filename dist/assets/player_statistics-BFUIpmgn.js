import"./modulepreload-polyfill-B5Qt9EMX.js";import{e as $,c as D,b as E,q as N,w as B,g as R,d as U}from"./firebase.config-IpTQKhZm.js";/* empty css             *//* empty css                               */import"./main-DLzLBIiP.js";import"./icon-component-BNGfFzw0.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";let P=new Map,A=new Map,L=new Map,k=[],O=null,T=[],H=[],W=[];const j=l=>{if(!l)return"N/A";const c=new Date(l),r=c.getDate(),s=c.getFullYear().toString().slice(-2),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()];return`${r} ${o} ${s}`},G=()=>{const l=new Date,r=l.getDay(),s=new Date(l);s.setDate(l.getDate()-r),s.setHours(0,0,0,0);const t=new Date(s);return t.setDate(s.getDate()+6),t.setHours(23,59,59,999),{start:s,end:t}};async function J(){try{const[l,c,r]=await Promise.all([$(D(E,"players_public")),$(D(E,"teams")),$(D(E,"competitions"))]);l.forEach(d=>P.set(d.id,{id:d.id,...d.data()})),c.forEach(d=>A.set(d.id,{id:d.id,...d.data()})),r.forEach(d=>L.set(d.id,d.data()));const s=N(D(E,"seasons"),B("status","==","current")),t=await $(s);if(t.empty){console.warn("No 'current' season found.");return}const o=t.docs[0].id,e=N(D(E,"match_results"),B("season","==",o)),[m,a]=await Promise.all([$(e),R(U(E,"league_tables",o))]);k=m.docs.map(d=>d.data()),O=a.exists()?a.data():null,_()}catch(l){console.error("Error fetching and calculating data:",l)}}function _(){T=Q(k,P,A,L),H=z(k,P),W=Y(k,P,A)}function Q(l,c,r,s,t){const o=new Map,e=new Map,{start:m,end:a}=G();l.filter(i=>i.status==="completed"&&(i.division==="premier-division"||i.division==="first-division")).forEach(i=>{e.set(i.homeTeamId,(e.get(i.homeTeamId)||0)+1),e.set(i.awayTeamId,(e.get(i.awayTeamId)||0)+1);const u=i.scheduledDate.toDate(),v=u>=m&&u<=a;[...i.homeScores||[],...i.awayScores||[]].forEach(h=>{const{playerId:f,score:w}=h;if(!f||f==="sixthPlayer")return;const b=o.get(f)||{totalPins:0,gamesPlayed:0,pinsThisWeek:[],gamesThisWeek:0};b.totalPins+=w,b.gamesPlayed+=1,v&&(b.pinsThisWeek.push(w),b.gamesThisWeek+=1),o.set(f,b)})});const n=Array.from(o.entries()).map(([i,u])=>{const v=c.get(i),h=v?r.get(v.teamId):null,f=h?s.get(h.division):null,w=h&&e.get(v.teamId)||0,b=u.pinsThisWeek.reduce((C,q)=>C+q,0),x=u.totalPins-b,F=u.gamesPlayed-u.gamesThisWeek,M=F>0?x/F:0,S=u.gamesPlayed>0?u.totalPins/u.gamesPlayed:0,V=u.gamesThisWeek>0&&M>0?S-M:0;return{playerId:i,name:v?`${v.firstName} ${v.lastName}`:"Unknown",teamName:h?h.name:"Unknown",teamId:v?v.teamId:null,division:v?v.division:"N/A",league:f?f.shortName:"N/A",gamesPlayed:u.gamesPlayed,totalPins:u.totalPins,pinsThisWeek:u.pinsThisWeek,average:S.toFixed(2),rawAverage:S,averageMovement:V,eligible:u.gamesPlayed>=w/2,totalTeamGames:w}}).sort((i,u)=>u.rawAverage-i.rawAverage);let I=0,p=null;n.forEach((i,u)=>{i.average!==p&&(I=u+1),i.overallRank=I,p=i.average});const g={PDIV:0,FDIV:0,"Ladies'":0};return n.forEach(i=>{i.eligible&&(i.league==="PDIV"&&i.rawAverage>g.PDIV&&(g.PDIV=i.rawAverage),i.league==="FDIV"&&i.rawAverage>g.FDIV&&(g.FDIV=i.rawAverage),i.division==="Ladies'"&&i.rawAverage>g["Ladies'"]&&(g["Ladies'"]=i.rawAverage))}),n.forEach(i=>{i.isDivisionLeader=!1,i.eligible&&(i.league==="PDIV"&&i.rawAverage===g.PDIV&&g.PDIV>0&&(i.isDivisionLeader=!0),i.league==="FDIV"&&i.rawAverage===g.FDIV&&g.FDIV>0&&(i.isDivisionLeader=!0),i.division==="Ladies'"&&i.rawAverage===g["Ladies'"]&&g["Ladies'"]>0&&(i.isDivisionLeader=!0))}),n}function z(l,c){const r=new Map;return l.forEach(s=>{s.status==="completed"&&[...s.homeScores||[],...s.awayScores||[]].forEach(t=>{if(!t.playerId||!t.hands||t.playerId==="sixthPlayer")return;const o=t.hands.filter(e=>e>=10);if(o.length>0){const e=r.get(t.playerId)||{count:0,totalPins:0};e.count+=o.length,e.totalPins+=o.reduce((m,a)=>m+a,0),r.set(t.playerId,e)}})}),Array.from(r.entries()).map(([s,t])=>{const o=c.get(s),e=o?A.get(o.teamId):null,m=e?L.get(e.division):null;return{playerId:s,name:o?`${o.firstName} ${o.lastName}`:"Unknown",teamName:e?e.name:"Unknown",teamId:o?o.teamId:null,division:o?o.division:"N/A",league:m?m.shortName:"N/A",spares:t.count,extraPins:t.totalPins-t.count*9,average:(t.totalPins/t.count).toFixed(2)}}).sort((s,t)=>t.spares-s.spares||t.extraPins-s.extraPins||s.name.localeCompare(t.name))}function Y(l,c,r){const s=new Map;return l.forEach(t=>{if(t.status!=="completed")return;const o=(e,m)=>{e&&e.forEach(a=>{var g;const{playerId:d,score:n}=a;if(!d||d==="sixthPlayer")return;const I=((g=r.get(m))==null?void 0:g.name)||"Unknown",p=t.scheduledDate.toDate();(!s.has(d)||n>s.get(d).score||n===s.get(d).score&&p<s.get(d).date)&&s.set(d,{score:n,date:p,opponent:I})})};o(t.homeScores,t.awayTeamId),o(t.awayScores,t.homeTeamId)}),Array.from(s.entries()).map(([t,o])=>{const e=c.get(t),m=e?r.get(e.teamId):null,a=m?L.get(m.division):null;return{playerId:t,name:e?`${e.firstName} ${e.lastName}`:"Unknown",teamName:m?m.name:"Unknown",teamId:e?e.teamId:null,division:e?e.division:"N/A",league:a?a.shortName:"N/A",score:o.score,date:o.date,opponent:o.opponent}}).sort((t,o)=>o.score-t.score||t.date-o.date)}function K(){const l=[...new Set(T.map(e=>e.teamName))].sort(),c=[...new Set(T.map(e=>e.division))].filter(e=>e&&e!=="N/A").sort(),r=[...new Set(T.map(e=>e.league))].sort(),s=document.getElementById("team-filter"),t=document.getElementById("division-filter"),o=document.getElementById("league-filter");s.innerHTML=`<option value="">All Teams</option>${l.map(e=>`<option value="${e}">${e}</option>`).join("")}`,t.innerHTML=`<option value="">All Divisions</option>${c.map(e=>`<option value="${e}">${e}</option>`).join("")}`,o.innerHTML=`<option value="">All Leagues</option>${r.map(e=>`<option value="${e}">${e}</option>`).join("")}`}function y(){var c;const l=(c=document.querySelector(".tab-link.active"))==null?void 0:c.dataset.tab;l==="averages"&&X(),l==="spares"&&Z(),l==="high-scores"&&ee()}function X(){const l=document.getElementById("averages-content");if(!l)return;const c=l.querySelector(".stats-table-container")||document.createElement("div");if(c.className="stats-table-container",l.innerHTML="",l.appendChild(c),T.length===0){c.innerHTML="<p>No completed league match results found for the current season.</p>";return}const r=document.getElementById("team-filter").value,s=document.getElementById("division-filter").value,t=document.getElementById("league-filter").value,o=document.getElementById("hide-ineligible-filter").checked,e=r||s||t,m=T.filter(n=>!(o&&!n.eligible||r&&n.teamName!==r||s&&n.division!==s||t&&n.league!==t));let a=`<table class="stats-table"><thead><tr>
                    <th>Rank</th><th></th><th class="player-col">Player</th><th class="team-col">Team</th>
                    <th colspan="2" class="divisions-header">Divisions</th>
                    <th>PLD</th><th class="total-pins-header">Total Pins</th><th class="main-stat">Average</th><th>Movement</th>
                    </tr></thead><tbody>`,d=null;m.forEach((n,I)=>{let p=I+1;d&&n.average===d&&(p="=");const g=e?`${p} (${n.overallRank})`:p,i=`${n.eligible?"":"ineligible-player"} ${n.isDivisionLeader?"division-leader":""}`,u=n.pinsThisWeek.length>0?`<span class="weekly-score-value">+${n.pinsThisWeek.join(" +")}</span>`:'<span class="weekly-score-value"></span>',v=`<div class="total-pins-cell"><span class="total-pins-value">${n.totalPins.toLocaleString()}</span>${u}</div>`;let h="-",f="";n.averageMovement>1e-4?(h=`+${n.averageMovement.toFixed(2)}`,f="movement-positive"):n.averageMovement<-1e-4&&(h=n.averageMovement.toFixed(2),f="movement-negative"),a+=`<tr class="${i.trim()}">
            <td>${g}</td>
            <td class="profile-icon-cell"><a href="public-profile.html?playerId=${n.playerId}"><icon-component name="user-id"></icon-component></a></td>
            <td class="player-col">${n.name}</td>
            <td class="team-col">${n.teamName}</td>
            <td class="division-col">${n.division}</td>
            <td class="league-col">${n.league}</td>
            <td>${n.gamesPlayed} <span class="team-games-played">[${n.totalTeamGames}]</span></td>
            <td>${v}</td>
            <td class="main-stat">${n.average}</td>
            <td class="movement-cell ${f}">${h}</td>
            </tr>`,d=n.average}),a+="</tbody></table>",c.innerHTML=a}function Z(){const l=document.getElementById("spares-content");if(!l)return;const c=document.getElementById("team-filter").value,r=document.getElementById("division-filter").value,s=document.getElementById("league-filter").value,t=H.filter(a=>!(c&&a.teamName!==c||r&&a.division!==r||s&&a.league!==s)),o='<div class="stats-narrative"><p>A spare is defined as any score of 10 and above.</p></div>';let e='<div class="stats-table-container"><table class="stats-table"><thead><tr><th>Rank</th><th></th><th class="player-col">Player</th><th class="team-col">Team</th><th class="main-stat">Spares</th><th>Extra Pins</th><th>Average</th></tr></thead><tbody>',m=null;t.forEach((a,d)=>{let n=d+1;m&&a.spares===m.spares&&a.extraPins===m.extraPins&&(n="="),e+=`<tr>
            <td>${n}</td>
            <td class="profile-icon-cell"><a href="public-profile.html?playerId=${a.playerId}"><icon-component name="user-id"></icon-component></a></td>
            <td class="player-col">${a.name}</td>
            <td class="team-col">${a.teamName}</td>
            <td class="main-stat">${a.spares}</td>
            <td>${a.extraPins}</td>
            <td>${a.average}</td>
            </tr>`,m=a}),e+="</tbody></table></div>",l.innerHTML=o+e}function ee(){const l=document.getElementById("high-scores-content");if(!l)return;const c=document.getElementById("team-filter").value,r=document.getElementById("division-filter").value,s=document.getElementById("league-filter").value,t=W.filter(a=>!(c&&a.teamName!==c||r&&a.division!==r||s&&a.league!==s)),o='<div class="stats-narrative"><p>A High Score is an individual score achieved in any league or cup fixture.</p></div>';let e='<div class="stats-table-container"><table class="stats-table"><thead><tr><th>Rank</th><th></th><th class="player-col">Player</th><th class="team-col">Team</th><th class="main-stat">High Score</th><th>Date</th><th class="opponent-col">Opponent</th></tr></thead><tbody>',m=null;t.forEach((a,d)=>{let n=d+1;m&&a.score===m&&(n="="),e+=`<tr>
            <td>${n}</td>
            <td class="profile-icon-cell"><a href="public-profile.html?playerId=${a.playerId}"><icon-component name="user-id"></icon-component></a></td>
            <td class="player-col">${a.name}</td>
            <td class="team-col">${a.teamName}</td>
            <td class="main-stat">${a.score}</td>
            <td>${j(a.date)}</td>
            <td class="opponent-col">vs ${a.opponent}</td>
            </tr>`,m=a.score}),e+="</tbody></table></div>",l.innerHTML=o+e}function te(){const l=document.querySelectorAll(".tab-link"),c=document.querySelectorAll(".tab-pane"),r=document.getElementById("team-filter"),s=document.getElementById("division-filter"),t=document.getElementById("league-filter"),o=document.getElementById("hide-ineligible-filter"),e=document.getElementById("clear-filters-btn");l.forEach(a=>{a.addEventListener("click",()=>{l.forEach(n=>n.classList.remove("active")),a.classList.add("active"),c.forEach(n=>{const I=a.dataset.tab;n.classList.toggle("active",n.id===`${I}-content`)});const d=a.dataset.tab==="averages";document.getElementById("stats-header-container").style.display=d?"flex":"none",y()})});const m=a=>{[r,s,t].forEach(n=>{n!==a&&a.value!==""?n.disabled=!0:n.disabled=!1}),y()};r.addEventListener("change",()=>m(r)),s.addEventListener("change",()=>m(s)),t.addEventListener("change",()=>m(t)),o.addEventListener("change",y),e.addEventListener("click",()=>{r.value="",s.value="",t.value="",o.checked=!0,m({value:""})})}async function ae(){var r;document.getElementById("averages-content").innerHTML="<p>Loading statistics...</p>",await J(),K(),te(),y();const c=((r=document.querySelector(".tab-link.active"))==null?void 0:r.dataset.tab)==="averages";document.getElementById("stats-header-container").style.display=c?"flex":"none"}document.addEventListener("DOMContentLoaded",ae);
